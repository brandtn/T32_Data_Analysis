---
title: "T32"
author: "Nathan Brandt"
date: "3/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load Libraries
```{r}
library("tidyverse")
library("googlesheets") #GoogleSheets Info https://cran.r-project.org/web/packages/googlesheets/vignettes/basic-usage.html
library("ggpubr")
```

#Functions
```{r , echo=FALSE}
#Function to convert university date code into decipherable terms, returns the year
convertdate_year <- function(x) {

  if (is.na(x)) {return(x)}
  #first charater is either 0 or 1, 0 = 19, 1 = 20
  #Second two characters are the year, concate to first character transformation
  #Last character is the semester, save to second vector spot
  
  if (substr(x, 1, 1) == 0) {
    date <- paste(19, substr(x, 2, 3), sep = "")
  } else if (substr(x, 1, 1) == 1) {
    date <- paste(20, substr(x, 2, 3), sep = "")
  }
  return(as.numeric(date))
}

#Function to convert university date code into decipherable terms, returns the semester
#May not need
convertdate_semester <- function(x) {  
  if (is.na(x)) {return(x)}
  
  # Last/Fourth character conver to semseter, 2 = Winter, 4 = Spring, 6 = Summer, 8 = Fall
  if (substr(x, 4, 4)) { date <- 'Winter'
  } else if (substr(x, 4, 4)) {date <- 'Spring'
  } else if (substr(x, 4, 4)) {date <- 'Summer'
  } else if (substr(x, 4, 4)) {date <- 'Fall'
  } 
  #return date
  return(as.character(date))
}
```

#To Update Data
```{r}

#Do you want to update
update <- 'No'

if(update == 'Yes') {
  #Reads in list of PIs
  pi.list <- select(gs_read(ss = gs_title("PI_Contact_Info_Tracker")), PI)
  #Adds in first
  t32 <- gs_read(ss = gs_title(paste("T_32_PhD_Info_",pi.list[1, 1], sep = "")))
  #goes through the rest
  for(x in 2:length(pi.list$PI)) {
    t32 <- bind_rows(t32, gs_read(ss = gs_title(paste("T_32_PhD_Info_",pi.list[x, 1], sep = ""))))
  }

  #creates a new sheet
  gs_new("T32_Update", ws_title = "Data", input = t32, trim = TRUE)

  #Edits old sheet to update
  #gs_edit_cells("T32_Update", ws = "Data", input = t32)
}
```

#Aquire Data
``` {r}
#read in and check data from Google Sheet
#First Time requires the input of an authroazation key
current.sheet <- 'T_32_Updated_03222018'
student_data <- gs_read(ss = gs_title(current.sheet))

#Convert to Usable Dates - Years only for now
student_data$First_Term <- sapply(student_data$First_Term, convertdate_year)
student_data$Most_Recent <- sapply(student_data$Most_Recent, convertdate_year)
student_data$GABIOLMS <- sapply(student_data$GABIOLMS, convertdate_year)
student_data$GABIOLPHD <- sapply(student_data$GABIOLPHD, convertdate_year)

#Correct data types for proper analysis
student_data$Citz_Stat_Cd <- as.factor(student_data$Citz_Stat_Cd)

glimpse(student_data)

#Read in Faculty List for analysis
faculty <- gs_read(ss = gs_title("Faculty_List"))

glimpse(faculty)
```


#Set global vairable
```{r}
#Filter by Year
filter.year <- 2000
```

